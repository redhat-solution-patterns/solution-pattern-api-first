<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solution Pattern: Manage and Secure APIs with an API First Approach :: Solution Patterns from Red Hat</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/api-first/02-architecture.html">
    <link rel="prev" href="index.html#_developer_resources">
    <link rel="next" href="03-demo.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9TW8CJFT3N"></script>
<script>function gtag() { dataLayer.push(arguments) }; window.dataLayer = window.dataLayer || []; gtag('js', new Date()); gtag('config', 'G-9TW8CJFT3N')</script>
  </head>
  <body class="article">

<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('USERID');
      const subdomain = urlParams.get('SUBDOMAIN'); 
      if (userId) {
        showUserId( userId, subdomain);
      }
      else {
        showUserIdForm(subdomain);
      }
    } );


    function showUserId( userId, subdomain) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('userIdDisplay').textContent = "User ID : " + userId;
      document.getElementById('subdomainDisplay').textContent = "Subdomain : " + subdomain; 
    }

    function showUserIdForm( subdomain ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
      document.getElementById('subdomain').value = subdomain; 

    }

    function goWithUserId() {
      elUserIdInput = document.getElementById('userId');
      elSubdomainInput = document.getElementById('subdomain');
      window.location.search = ('&USERID=' + elUserIdInput.value  + '&SUBDOMAIN=' + elSubdomainInput.value);
    }

    function recycle() {
      document.getElementById('userId').value='';
      document.getElementById('subdomain').value='';
      window.location.search = ('');
    }


  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white" href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns from Red Hat</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Architectures &amp; Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
            <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html"  target="_blank">Solution Patterns </a>
            <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
            <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
            <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
          </div>
        </div>

          <a class="navbar-item" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>
          <a class="navbar-item" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

          <div class="navbar-item" >         
              <div id="navbar-form-empty">
                <span >
                  <span>
                    &nbsp;
                    <i style="color: orange;" class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                  </span>
                  Your Workshop Environment
                <form action="javascript:void(0);" onsu>
                  <input size="20" id="userId" type="text" placeholder="USER ID">
                  <input size="20" id="subdomain" type="text" placeholder="Subdomain">
                  <button type="hidden" onclick="goWithUserId();">Set</button>
                </form>
                </span>
              </div>
        
              <div  id="navbar-form-filled" style="display: none;">
                <span>
                <span>
                  Your Workshop Environment
                    <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">
                    <i alt="Clear details" title="Clear details" onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i>
                    <br><span  id="userIdDisplay"></span> <span>|</span>
                <span id="subdomainDisplay"></span>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>

<div class="body">
<div class="nav-container" data-component="api-first" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">API-first approach</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#_the_solution">1.3 The solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_developer_resources">1.4 Developer Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tech_stack">2.1. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#in_depth">2.2. An in-depth look at the solution&#8217;s architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#more_tech">2.3. More about the technology stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#_setup_the_solution">3.1. Setup the solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#_walkthrough_guide">3.2. Walkthrough guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">API-first approach</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">API-first approach</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">API-first approach</a></li>
    <li><a href="02-architecture.html">2. Architecture</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-solution-patterns/solution-pattern-api-first/edit/main/documentation/modules/ROOT/pages/02-architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Solution Pattern: Manage and Secure APIs with an API First Approach</h1>
<h1 id="_architecture" class="sect0"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">Architecture</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The architecture will need to support these paradigms</p>
</div>
<div class="ulist">
<ul>
<li>
<p>API First Approach resulting in OpenAPI specifications</p>
</li>
<li>
<p>Enable Parallel development streams</p>
</li>
<li>
<p>Managed API Management platform for securing and managing the backend services</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_challenges"><a class="anchor" href="#_common_challenges"></a><a class="link" href="#_common_challenges">1. Common Challenges</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are however a number of challenges with the new requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding new channels remains difficult, with a high risk of tight coupling to the existing services, which would slow down development productivity and time to market.</p>
</li>
<li>
<p>The existing services need to be managed and secured to allow access for external partners and development teams. Governance remains a challenge.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to cope with these challenges, the development team decides for a new approach.</p>
</div>
<div class="paragraph">
<p><strong>API First approach</strong>: before tackling the development of new services, the API contract is formalized in a OpenAPI spec document. This API design phase is done collaboratively with all stakeholders. Once a first version of the OpenAPI spec document is ready, it is pushed and managed in a service registry, which acts a the system of truth. Mocks are created for the API.</p>
</div>
<div class="paragraph">
<p><strong>Parallel Development streams</strong>: The API first approach enables parallel development streams. UI development teams and other API consumers can start their development against the mocked APIs, without having to wait for an actual implementation. In parallel, backend development teams can implement the APIs using modern cloud-native frameworks. They continuously test the implementation against the OpenAPI spec to ensure that the implementation does not break the contract.</p>
</div>
<div class="paragraph">
<p><strong>Manage and Secure the APIs</strong>: An API management platform allows to expose the APIs in a secure and managed manner for access by the mobile app and other third party applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tech_stack"><a class="anchor" href="#tech_stack"></a><a class="link" href="#tech_stack">2. Technology Stack</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.redhat.com/products/3scale/overview" target="_blank" rel="noopener">Red Hat 3scale API Management</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_build_of_apicurio_registry" target="_blank" rel="noopener">Red Hat build of Apicurio Registry</a></p>
</li>
<li>
<p><a href="https://developers.redhat.com/products/quarkus/overview" target="_blank" rel="noopener">Red Hat build of Quarkus</a></p>
</li>
<li>
<p><a href="https://studio.apicur.io/" target="_blank" rel="noopener">Apicurio API Designer</a></p>
</li>
<li>
<p><a href="https://microcks.io/" target="_blank" rel="noopener">Microcks</a></p>
</li>
<li>
<p><a href="https://quay.io/" target="_blank" rel="noopener">Quay</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="in_depth"><a class="anchor" href="#in_depth"></a><a class="link" href="#in_depth">3. An in-depth look at the solution&#8217;s architecture</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is a view of the deployment architecture.<br></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/globex-deployment-apim.png" alt="globex deployment apim">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The services (primarily Inventory and Catalog), and the databases are deployed on Red Hat OpenShift.</p>
</li>
<li>
<p>API Designer and Red Hat build of Apicurio Registry, based on <a href="https://www.apicur.io/" target="info">Apicurio</a>, are used to <strong>Design</strong> and <strong>Govern</strong> the APIs</p>
</li>
<li>
<p><a href="https://microcks.io/" target="info">Microcks</a>, a popular opensource project, is used to <strong>mock</strong> the APIs</p>
</li>
<li>
<p><a href="https://www.redhat.com/en/technologies/jboss-middleware/3scale" target="info">Red Hat 3scale Management</a> is an API Management platform used to <strong>manage and secure</strong> the APIs. 3scale allows you to offer the same set of APIs for different audiences through packaging and unique consumption plans.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="more_tech"><a class="anchor" href="#more_tech"></a><a class="link" href="#more_tech">4. More about the Technology Stack</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apicurio"><a class="anchor" href="#_apicurio"></a><a class="link" href="#_apicurio">4.1. Apicurio</a></h3>
<div class="paragraph">
<p>As part of the API-First approach, the first step, of course, is to design the APIs. API Designer is a tool to design your APIs (OpenAPI, AsyncAPI) and schemas (Apache Avro, Google Protobuf, JSON Schema). Even before the implementation starts, the various stakeholders come together to define the API specs. The API are defined for the existing catalogue service as well.</p>
</div>
<div class="paragraph">
<p>This designer provides a graphical way of designing all the aspects of an OpenAPI - had different paths, datatypes and canned responses. It also allows you to work in both a graphical way of doing things and also with the source. The OpenAPI can be viewed as both a YAML and a JSON document.</p>
</div>
</div>
<div class="sect2">
<h3 id="service-registry"><a class="anchor" href="#service-registry"></a><a class="link" href="#service-registry">4.2. Service Registry</a></h3>
<div class="paragraph">
<p>Once the API design is complete, and we have the first version of the API, this can now be published  in a schema registry.
<a href="https://access.redhat.com/documentation/en-us/red_hat_build_of_apicurio_registry" target="_blank" rel="noopener">Red Hat build of Apicurio Registry</a> is a datastore for sharing standard event schemas and API designs across event-driven and API architectures.</p>
</div>
<div class="paragraph">
<p>You can upload new artifacts, new versions,  view the metadata, download the specs, view documentation and view the content as well.
Through Content rules one can validate new versions of the APIs against the existing specs to ensure validity and backward compatibility.</p>
</div>
</div>
<div class="sect2">
<h3 id="Microcks"><a class="anchor" href="#Microcks"></a><a class="link" href="#Microcks">4.3. Microcks</a></h3>
<div class="paragraph">
<p>We can also build mocks for the APIs using the same OpenAPIs.</p>
</div>
<div class="paragraph">
<p>Microcks is a tool which allows one to upload the same OpenAPI spec, and to build mocks for the APIs. This is for use of the teams who will actually consume the APIs and they can use these mocks to develop their pieces of code even before the APIs are completely implemented</p>
</div>
<div class="paragraph">
<p>Each of the mocks that are created out of the OpenAPI&#8217;s examples   has its own URL which can be invoked to provide a realistic response. This allows front end and mobile app developers to develop against the OpenAPIs specs without waiting for the final implementation of the backend services.</p>
</div>
</div>
<div class="sect2">
<h3 id="3scale"><a class="anchor" href="#3scale"></a><a class="link" href="#3scale">4.4. Red Hat 3scale API Management</a></h3>
<div class="paragraph">
<p>We use the managed <strong>Red Hat 3scale API Management</strong> platform here to publish, manage and secure the backend APIs.</p>
</div>
<div class="paragraph">
<p>Each API can be configured to be secured using a number of ways. In this case, the APIs  are secured with an API key which should be passed through http request header. 3scale allows you to have various application plans. Developers can subscribe to those APIs and can access APIs through an assigned API key  securely.  You can monitor the APIs and also track usage</p>
</div>
<div class="paragraph">
<p>As a developer, you would like to build functionality around the APIs. There is also a Development Portal  which is currently under, well, development. You can sign in as a developer here.  This developer  has already subscribed to the API and is given an API key which should be used in all API calls to ensure the calls are authenticated by the API management platform.</p>
</div>
<div class="paragraph">
<p>The devportal allows viewing Live documentation as well, which is another view of the OpenAPI specs. Developers can try it out  to see what kind of responses they can get back. The developers can also view statistics for their account  in a graph format</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html#_developer_resources" class="query-params-link">1.4 Developer Resources</a></span>
  <span class="next"><a href="03-demo.html" class="query-params-link">3. See the Solution in Action</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
